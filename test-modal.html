<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal Data</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        .test-button {
            padding: 10px 20px;
            background: #ff6b00;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #e55a00;
        }
        pre {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>Test Modal Data Access</h1>
    
    <button class="test-button" onclick="testWithoutAnalysis()">Test: Data Without 'analysis' wrapper</button>
    <button class="test-button" onclick="testWithAnalysis()">Test: Data With 'analysis' wrapper (MongoDB format)</button>
    
    <h2>Console Output:</h2>
    <pre id="output"></pre>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            output.textContent += message + '\n';
            console.log(message);
        }
        
        // Test with data NOT wrapped in 'analysis' (direct format)
        function testWithoutAnalysis() {
            output.textContent = ''; // Clear
            log('=== Testing Direct Data Format ===');
            
            const rack = {
                rack_name: "My Test Rack",
                filename: "test.adg",
                chains: [
                    {
                        name: "Chain 1",
                        devices: [
                            { name: "Reverb", on: true },
                            { name: "Delay", on: false }
                        ]
                    }
                ],
                macro_controls: [
                    { name: "Wet/Dry", value: 0.5 }
                ]
            };
            
            log(`Accessing rack.chains: ${rack.chains ? 'Found' : 'NOT FOUND'}`);
            log(`Number of chains: ${rack.chains?.length || 0}`);
            log(`Accessing rack.analysis?.chains: ${rack.analysis?.chains ? 'Found' : 'NOT FOUND'}`);
            log(`Number of chains via analysis: ${rack.analysis?.chains?.length || 0}`);
        }
        
        // Test with data wrapped in 'analysis' (MongoDB format)
        function testWithAnalysis() {
            output.textContent = ''; // Clear
            log('=== Testing MongoDB Data Format ===');
            
            const rack = {
                _id: "507f1f77bcf86cd799439011",
                rack_name: "My Test Rack",
                filename: "test.adg",
                created_at: new Date(),
                analysis: {
                    rack_type: "Audio Effect Rack",
                    chains: [
                        {
                            name: "Chain 1",
                            devices: [
                                { name: "Reverb", on: true },
                                { name: "Delay", on: false }
                            ]
                        }
                    ],
                    macro_controls: [
                        { name: "Wet/Dry", value: 0.5 }
                    ]
                },
                stats: {
                    total_chains: 1,
                    total_devices: 2,
                    macro_controls: 1
                },
                user_info: {
                    producer_name: "Test Producer",
                    description: "Test description",
                    tags: ["ambient", "reverb"]
                }
            };
            
            log(`Accessing rack.chains: ${rack.chains ? 'Found' : 'NOT FOUND'}`);
            log(`Number of chains: ${rack.chains?.length || 0}`);
            log(`Accessing rack.analysis?.chains: ${rack.analysis?.chains ? 'Found' : 'NOT FOUND'}`);
            log(`Number of chains via analysis: ${rack.analysis?.chains?.length || 0}`);
            log(`\nThis shows that MongoDB stores chains inside 'analysis' field!`);
            log(`\nCorrect way to access:`);
            log(`- Chains: rack.analysis?.chains`);
            log(`- Macros: rack.analysis?.macro_controls`);
            log(`- Type: rack.analysis?.rack_type`);
        }
    </script>
</body>
</html>
